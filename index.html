<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>センサー値を表示</title>
	</head>
	<body>
		<main>
			<button id="permbtn">あなたのスマホのフルパワーを今すぐ確認！</button>
			<ul id="output" style="display: none;">
				<li id="latitude">0</li>
				<li id="longitude">0</li>
				<li id="altitude">0</li>
				<li id="accuracy">0</li>
				<li id="altitudeAccuracy">0</li>
				<li id="webkitCompassHeading">0</li>
				<li id="webkitCompassAccuracy">0</li>
				<li id="alpha">0</li>
				<li id="beta">0</li>
				<li id="gamma">0</li>
				<li id="accelerationX">0</li>
				<li id="accelerationY">0</li>
				<li id="accelerationZ">0</li>
				<li id="accelerationIncludingGravityX">0</li>
				<li id="accelerationIncludingGravityY">0</li>
				<li id="accelerationIncludingGravityZ">0</li>
				<li id="rotationRateAbsolute">0</li>
				<li id="rotationRateAlpha">0</li>
				<li id="rotationRateBeta">0</li>
				<li id="rotationRateGamma">0</li>
			</ul>
		</main>
		<script>
			'use strict';

			const objdata = {
				webkitCompassHeading: 0,
				webkitCompassAccurac: 0,
				alpha: 0,
				beta: 0,
				gamma: 0,
				acceleration: {
				x: 0,
				y: 0,
				z: 0
				},
				accelerationIncludingGravity: {
				x: 0,
				y: 0,
				z: 0
				},
				rotationRate: {
				alpha: 0,
				beta: 0,
				gamma: 0
				},
				coords: {
					latitude: 0,
					longitude: 0,
					altitude: 0,
					accuracy: 0,
					altitudeAccuracy: 0
				}
			};
			const fail = () => document.getElementById('permbtn').textContent = 'ごめん無理だった…。';
			const succ = () => {
				document.getElementById('permbtn').style.display = 'none';
				document.getElementById('output').style.display = 'block';
				navigator.geolocation.getCurrentPosition(e => {
					objdata.coords.latitude = e.coords.latitude;
					objdata.coords.longitude = e.coords.longitude;
					objdata.coords.altitude = e.coords.altitude;
					objdata.coords.accuracy = e.coords.accuracy;
					objdata.coords.altitudeAccuracy = e.coords.altitudeAccuracy;
				});
				window.addEventListener('devicemotion', e => {
					objdata.acceleration.x = e.acceleration.x;
					objdata.acceleration.y = e.acceleration.y;
					objdata.acceleration.z = e.acceleration.z;
					objdata.accelerationIncludingGravity.x = e.accelerationIncludingGravity.x;
					objdata.accelerationIncludingGravity.y = e.accelerationIncludingGravity.y;
					objdata.accelerationIncludingGravity.z = e.accelerationIncludingGravity.z;
					objdata.rotationRate.alpha = e.rotationRate.alpha;
					objdata.rotationRate.beta = e.rotationRate.beta;
					objdata.rotationRate.gamma = e.rotationRate.gamma;
				});
				window.addEventListener('deviceorientation', e => {
					objdata.webkitCompassHeading = e.webkitCompassHeading;
					objdata.webkitCompassAccuracy = e.webkitCompassAccuracy;
					objdata.alpha = e.alpha;
					objdata.beta = e.beta;
					objdata.gamma = e.gamma;
				});
				window.setInterval(() => {
					document.getElementById('latitude').textContent = `latitude: ${objdata.coords.latitude}`;
					document.getElementById('longitude').textContent = `longitude: ${objdata.coords.longitude}`;
					document.getElementById('altitude').textContent = `altitude: ${objdata.coords.altitude}`;
					document.getElementById('accuracy').textContent = `accuracy: ${objdata.coords.accuracy}`;
					document.getElementById('altitudeAccuracy').textContent = `altitudeAccuracy: ${objdata.coords.altitudeAccuracy}`;
					document.getElementById('webkitCompassHeading').textContent = `webkitCompassHeading: ${objdata.webkitCompassHeading}`;
					document.getElementById('webkitCompassAccuracy').textContent = `webkitCompassAccuracy: ${objdata.webkitCompassAccuracy}`;
					document.getElementById('alpha').textContent = `alpha: ${objdata.alpha}`;
					document.getElementById('beta').textContent = `beta: ${objdata.beta}`;
					document.getElementById('gamma').textContent = `gamma: ${objdata.gamma}`;
					document.getElementById('accelerationX').textContent = `accelerationX: ${objdata.acceleration.x}`;
					document.getElementById('accelerationY').textContent = `accelerationY: ${objdata.acceleration.y}`;
					document.getElementById('accelerationZ').textContent = `accelerationZ: ${objdata.acceleration.z}`;
					document.getElementById('accelerationIncludingGravityX').textContent = `accelerationIncludingGravityX: ${objdata.accelerationIncludingGravity.x}`;
					document.getElementById('accelerationIncludingGravityY').textContent = `accelerationIncludingGravityY: ${objdata.accelerationIncludingGravity.y}`;
					document.getElementById('accelerationIncludingGravityZ').textContent = `accelerationIncludingGravityZ: ${objdata.accelerationIncludingGravity.z}`;
					document.getElementById('rotationRateAlpha').textContent = `rotationRateAlpha: ${objdata.rotationRate.alpha}`;
					document.getElementById('rotationRateBeta').textContent = `rotationRateBeta: ${objdata.rotationRate.beta}`;
					document.getElementById('rotationRateGamma').textContent = `rotationRateGamma: ${objdata.rotationRate.gamma}`;
				}, 33);
			};


			const rp = () => {
				try {
					DeviceMotionEvent.requestPermission().then(mps => {
						DeviceOrientationEvent.requestPermission().then(ops => {
							if (mps === 'granted' && ops === 'granted') {
								succ();
							} else {
								fail();
							};
						});
					});
				} catch {
					fail();
				};
			};

			if (window.DeviceMotionEvent && DeviceMotionEvent.requestPermission && window.DeviceOrientationEvent && DeviceOrientationEvent.requestPermission) {
				if (typeof DeviceMotionEvent.requestPermission === 'function' && typeof DeviceOrientationEvent.requestPermission === 'function') {
					document.getElementById('permbtn').addEventListener('click', rp);
				} else {
					succ();
				};
			} else {
				document.getElementsByTagName('main')[0].textContent = 'ごめんwwそもそもこのスマホ対応してないわ。ってかこれ本当にスマホ？';
			};
		</script>
	</body>
</html>